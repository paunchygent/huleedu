---
description: Read when you run into trouble or when user request a debugging approach
globs: 
alwaysApply: false
---
===
# 110.4: Debugging Mode

## 1. Core Principle
**READ ERROR MESSAGES** - don't guess based on symptoms.

## 2. Debugging Process
- **Analyze**: Error messages, logs, codebase context
- **Hypothesize**: Formulate specific root cause theories
- **Research**: Use web_search for complex framework errors
- **Test**: Propose diagnostic steps to verify hypotheses
- **Fix**: Apply targeted code changes
- **Verify**: Confirm resolution

## 3. Common Patterns

### 3.1. Container Issues (Service Configuration Priority)
- Restart loops = often service configuration, not import failures
- `ModuleNotFoundError` = check `PYTHONPATH=/app` in Dockerfile first
- Constructor errors = check DI container usage vs manual instantiation

### 3.2. Service Configuration First
**Before investigating imports, check**:
- Docker environment variables and health check alignment
- Framework configuration methods (avoid "magic" like `config.from_object()`)
- DI container resolution vs manual dependency instantiation

**Refer to [044-service-debugging-and-troubleshooting.md](mdc:044-service-debugging-and-troubleshooting.md) for systematic priority order.**

### 3.3. Multi-Service Debugging
- **MUST** trace `correlation_id` through logs across services
- Use the standard runner with `-s` for debug output, e.g. `pdm run pytest-root -s <path>`

## 4. Container Log Debugging Best Practices

### 4.1. DO's for Container Logs
- **Start broad, then narrow**: Get recent logs first, then search
  ```bash
  # GOOD - see what's actually happening
  docker logs <container_name> --tail 200 2>&1 | grep -i processing
  ```
- **Use `--since` for time-based filtering**:
  ```bash
  docker logs <container_name> --since 1m 2>&1 | tail -50
  ```
- **Always redirect stderr**: Use `2>&1` to capture all output
- **Check container is running first**:
  ```bash
  docker ps | grep <service_name>
  ```

### 4.2. DON'Ts for Container Logs  
- **Don't grep for overly specific strings** that might not exist:
  ```bash
  # BAD - returns nothing even when events exist
  docker logs <container> | grep "exact string that may not appear"
  ```
- **Don't assume no output means no activity** - the log level might be wrong
- **Don't pipe grep to grep** - use regex patterns instead:
  ```bash
  # BAD
  docker logs <container> | grep ERROR | grep specific_error
  # GOOD
  docker logs <container> 2>&1 | grep -E "ERROR.*specific|specific.*ERROR"
  ```

### 4.3. Kafka Consumer Debugging
- **Check consumer group status**:
  ```bash
  docker exec huleedu_kafka /opt/bitnami/kafka/bin/kafka-consumer-groups.sh \
    --bootstrap-server localhost:9092 --group <group_name> --describe
  ```
- **Look for LAG values** - 0 means all messages consumed
- **Check if consumer is in the group** - missing means not connected

## 5. Tools
- `read_file`: Inspect code
- `grep_search`: Find error patterns
- `run_terminal_cmd`: Run tests with debug flags
- `web_search`: Research known issues and solutions

---
**Read the actual error messages.**
===
