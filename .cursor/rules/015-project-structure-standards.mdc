---
description: 
globs: 
alwaysApply: true
---
# 015: Project Structure Standards

## 1. Root Directory Structure

**Permitted Root Files:**
- `README.md`, `LICENSE`, `pyproject.toml`, `pdm.lock`, `docker-compose.yml`
- `.gitignore`, `.pdm-python`, `.dockerignore`, `AGENTS.md`

**Permitted Root Directories:**
- `.git/`, `.venv/`, `.mypy_cache/`, `__pycache__/`, `.cursor/`, `.ruff_cache/`, `.windsurf/`
- `common_core/`, `services/`, `scripts/`, `Documentation/`

**FORBIDDEN**: Setup scripts, service-specific files, temporary files in root

## 2. Scripts Directory Structure

```
scripts/
├── docs/                           # Script documentation
├── README.md                      
├── setup_huledu_environment.sh    
└── utils/                         # Utility scripts
```

## 3. Services Directory Structure

```
services/
├── libs/                          # Shared service libraries
├── content_service/               # Individual microservice (example Quart app)
│   ├── app.py                     # Quart application entry point
│   ├── pyproject.toml
│   ├── Dockerfile
│   ├── tests/
│   ├── protocols.py               # Optional: For defining service-specific behavioral contracts
│   └── docs/
├── batch_orchestrator_service/      # Individual microservice (primary orchestrator)
│   ├── app.py                     # Quart application entry point
│   ├── pyproject.toml
│   ├── protocols.py               # For defining service-specific behavioral contracts
│   └── ...
├── spell_checker_service/         # Example Kafka worker service
│   ├── worker_main.py             # Main entry point, DI setup, Kafka consumer loop
│   ├── event_router.py            # Event deserialization, protocol implementations, logic orchestration
│   ├── core_logic.py              # Core algorithms and helper functions
│   ├── protocols.py               # For defining service-specific behavioral contracts
│   ├── pyproject.toml
│   ├── Dockerfile
│   ├── tests/
│   └── docs/
└── essay_service/                 # Example, potentially more complex structure
```

**Note on Worker Service Structure (e.g., `spell_checker_service`):**
- `worker_main.py`: Handles service lifecycle (startup, shutdown), Kafka client management, signal handling, and the primary message consumption loop. Initializes DI container.
- `event_router.py`: Contains logic for deserializing incoming messages, implementing defined protocols (often by composing functions from `core_logic.py`), and orchestrating the processing flow for a single message.
- `core_logic.py`: Houses the fundamental, reusable business logic, algorithms, and interactions with external systems (like HTTP calls to other services), implemented as standalone functions or simple classes.
- `protocols.py`: Defines `typing.Protocol` interfaces for key internal dependencies and behavioral contracts, facilitating DI and testability.

## 4. Common Core Structure

```
common_core/
├── src/
│   └── common_core/
│       ├── __init__.py
│       ├── enums.py
│       ├── metadata_models.py
│       ├── events/
│       └── py.typed
├── tests/                         
├── pyproject.toml
└── README.md                      
```

## 5. Documentation Directory Structure

```
Documentation/
├── TASKS/
│   ├── PHASE_1.0.md               
│   ├── PHASE_1.1.md
│   └── PHASE_1.2.md
├── dependencies/
├── PDR:s/
└── setup_environment/
```

## 6. Documentation Placement Rules

- **Root README.md**: Project overview and architecture
- **Service README.md**: `services/{service_name}/README.md`
- **Common Core README.md**: `common_core/README.md`
- **FORBIDDEN**: README.md files in separate documentation folders

## 7. File Creation Rules

**MUST** verify target directory exists and follows this structure before creating files.
**MUST** create necessary parent directories if they don't exist.
**FORBIDDEN**: Files that violate this structure.
