---
description: Read before any tasks related to schemas, models, or cross-service communication
globs: 
alwaysApply: false
---
# 020: Architectural Mandates

Non-negotiable mandates **MUST** be followed by all services to ensure consistency and maintainability in the HuleEdu microservice architecture.

## 1. Domain-Driven Design (DDD) Mandates

### 1.1. Strict Bounded Contexts
- Each microservice **SHALL** map to a specific business domain (bounded context), owning its data and logic
- Service boundaries **MUST** be respected. Logic/data of one context **SHALL NOT** be in a service for another
- **MUST** identify the correct bounded context/microservice for task implementation

### 1.2. No Unauthorized Cross-Boundary Violations
- All inter-service communication **MUST** use explicitly defined, versioned contracts (Events or APIs)
- Direct access to another service's database/datastore is **STRICTLY FORBIDDEN**
- Direct internal function calls between distinct microservices bypassing contracts are **STRICTLY FORBIDDEN** (Shared `common/` utilities are an exception, not service logic)
- **SHALL NOT** propose solutions with such direct dependencies

## 2. Service Autonomy Mandates

### 2.1. Design for Independent Deployability
- Each microservice **MUST** be independently deployable, scalable, and updatable
- Build/deployment processes **SHALL NOT** have hard dependencies on unrelated services
- Configuration **MUST** be self-contained or centrally managed (service-agnostic)

### 2.2. Data (Schema) Ownership per Service
- Each microservice is the source of truth for its domain's data
- If using a shared DB during transition, each service **MUST** own and operate on an isolated schema
- A service **MUST NOT** directly write/modify another service's schema. Changes **MUST** be via the owning service's API or events

## 3. Explicit Contract Mandates (Pydantic)

### 3.1. Pydantic Models are the Contractual Single Source of Truth
- All inter-service data structures (event payloads, API DTOs) **MUST** be Pydantic models
- These models **SHALL** reside in `common/models/` (e.g., `common/events/data_models.py`, `common/models/api_schemas.py`)
- No ad-hoc dictionaries for inter-service communication
- **MUST** use or create Pydantic models from `common/` for inter-service data exchange code

### 3.2. Contract Versioning
- Pydantic contract models (especially for events) **MUST** be versioned (e.g., in event type name like `.v1`, `.v2`)
- Breaking changes to a Pydantic contract model **REQUIRE** a new contract version
- Services **MUST** handle different contract versions or have clear upgrade paths

### 3.3. Strict Schema Adherence
- Producers and consumers **MUST** strictly adhere to agreed Pydantic schema versions
- Producers **MUST** ensure data validates against the Pydantic model
- Consumers **MUST** validate received data against their expected Pydantic model
- **SHALL** generate code that performs such validation
