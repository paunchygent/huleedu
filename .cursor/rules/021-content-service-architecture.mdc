---
description: Defines the architecture and implementation details for the Content Service
globs: 
alwaysApply: false
---
# 021: Content Service Architecture

## 1. Service Identity
- **Package**: `huleedu-content-service`
- **Port**: 8000 (HTTP API)
- **Stack**: Quart, aiofiles, Hypercorn
- **Purpose**: Content storage and retrieval service

## 2. API Specification

### 2.1. Endpoints

#### POST /v1/content
- Store content and return storage ID
- **Request**: Raw binary data in request body
- **Response**: `{"storage_id": "uuid"}`
- **Status**: 201 (success), 400 (no data), 500 (storage error)

#### GET /v1/content/{content_id}
- Retrieve content by storage ID
- **Response**: Raw content data
- **Status**: 200 (success), 404 (not found), 500 (retrieval error)

#### GET /healthz
- Health check endpoint
- **Response**: `{"status": "ok"}`
- **Status**: 200 (healthy)

## 3. Storage Implementation

### 3.1. Storage Backend
- **Type**: Local filesystem storage
- **Root Path**: Configurable via `CONTENT_STORE_ROOT` environment variable
- **Default**: `/data/content_service_store`
- **File Naming**: UUID-based content IDs (no file extensions)

### 3.2. Storage Operations
- **Write**: Async file operations using `aiofiles`
- **Read**: Async file operations using `aiofiles`
- **Persistence**: Docker volume mount for data persistence

## 4. Configuration

### 4.1. Environment Variables
- `CONTENT_STORE_ROOT`: Storage root directory path
- `PORT`: HTTP server port (default: 8000)
- `LOG_LEVEL`: Logging level (default: INFO)

### 4.2. Dependencies
- `quart>=0.19.4`: Async web framework
- `aiofiles>=23.1.0`: Async file operations
- `hypercorn>=0.16.0`: ASGI server
- `python-dotenv>=1.0.0`: Environment configuration
- `huleedu-common-core`: Shared models and types

## 5. Integration Points

### 5.1. Consumers
- **Spell Checker Service**: Fetches original text, stores corrected text
- **Batch Service**: May store uploaded content
- **Future Services**: Any service requiring content storage

### 5.2. Communication Pattern
- **Protocol**: HTTP REST API
- **Data Format**: Raw binary content
- **Service Discovery**: Environment variable `CONTENT_SERVICE_URL`

## 6. Deployment

### 6.1. Docker Configuration
- **Base Image**: `python:3.11-slim`
- **Package Manager**: PDM
- **Volume Mount**: `/data/content_service_store`
- **Health Check**: `/healthz` endpoint

### 6.2. Development Commands
- `pdm run start`: Production server with Hypercorn
- `pdm run dev`: Development server with debug mode

## 7. Monitoring and Logging

### 7.1. Logging
- **Format**: Structured logging with timestamps
- **Levels**: INFO for operations, ERROR for failures
- **Content**: Storage operations, retrieval requests, errors

### 7.2. Metrics (Future)
- Storage operations count
- Content size metrics
- Response time metrics

## 8. Security Considerations

### 8.1. Current Implementation
- No authentication (internal service)
- No content validation
- No access control

### 8.2. Future Enhancements
- Content type validation
- Size limits
- Access control integration

## 9. Limitations and Future Work

### 9.1. Current Limitations
- Local filesystem only (no cloud storage)
- No content deduplication
- No metadata storage
- No content versioning

### 9.2. Planned Enhancements
- Cloud storage backend (S3, etc.)
- Content metadata tracking
- Content type detection
- Compression support
