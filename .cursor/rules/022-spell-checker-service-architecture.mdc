---
description: defines the architecture and implementation details of the HuleEdu Spell Checker Service
globs: 
alwaysApply: false
---
# 022: Spell Checker Service Architecture

## 1. Service Identity
- **Package**: `huleedu-spell-checker-service`
- **Type**: Kafka Consumer Worker (no HTTP API)
- **Stack**: aiokafka, aiohttp, Python asyncio
- **Purpose**: Event-driven spell checking service

## 2. Event-Driven Architecture

**Consumes**: `essay.spellcheck.requested.v1` (`SpellcheckRequestedDataV1`)
**Publishes**: `essay.spellcheck.completed.v1` (`SpellcheckResultDataV1`)
**Consumer Group**: `spellchecker-service-group`

**Flow**: Consume → Extract storage_id → Fetch text → Spell check → Store result → Publish → Commit

## 3. Integration Points

- **Content Service**: HTTP REST API via aiohttp.ClientSession
- **Kafka**: AIOKafkaConsumer/Producer with manual offset management

## 4. Spell Checking Implementation

**Current**: Dummy implementation with simple replacements ("teh" → "the")
**Future**: pyspellchecker, symspellpy, or SparkNLP integration

## 5. Configuration

**Environment**: `KAFKA_BOOTSTRAP_SERVERS`, `CONTENT_SERVICE_URL`, `LOG_LEVEL`
**Dependencies**: aiokafka, aiohttp, huleedu-common-core, huleedu-service-libs

## 6. Error Handling

**Scenarios**: Content Service unavailable, invalid event format, spell check failure
**Pattern**: Log error, commit offset, skip/publish failure event
**Future**: Circuit breaker, dead letter queue, retry logic

## 7. Data Models

**Input**: `SpellcheckRequestedDataV1` with entity_ref, system_metadata, text_storage_id
**Output**: `SpellcheckResultDataV1` with entity_ref, system_metadata, storage_metadata, corrections_made

## 8. Deployment

**Docker**: `python:3.11-slim` base, PDM, `python worker.py`
**Command**: `pdm run start_worker`

## 9. Future Enhancements

**Security**: Service auth, message encryption, input sanitization
**Performance**: Parallel processing, content caching, batch spell checking
