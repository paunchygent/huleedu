---
description: 
globs: 
alwaysApply: true
---
===
# 050: Python Coding Standards

## 1. Core Philosophy
- Readability first. Explicit over implicit. Simple over complex.
- SOLID, DRY, YAGNI principles.

## 2. Tooling & Formatting

### 2.1. Ruff (Formatting and Linting)
- **Commands**: `pdm run format-all`, `pdm run lint-all`
- **Auto-fix**: `ruff check --fix --force-exclude .`
- **Configuration**: `pyproject.toml` under `[tool.ruff]`
- **MUST** use `--force-exclude` flag
- **MUST** be Ruff compliant

## 3. Static Typing (Mypy)

### 3.1. Type Hinting Rules
- **MUST** type-annotate all public functions, methods, class attributes
- **MUST** use `from __future__ import annotations`
- **MUST** prefer precise types over `typing.Any`
- **MUST** pass `pdm run typecheck-all`
- **FORBIDDEN**: `typing.Any` where precise type possible

### 3.2. Dependency Injection Principle
- Business logic **MUST** depend on abstractions (`typing.Protocol`), not concrete implementations.
- **MUST** use Dishka DI framework; every provider lives in `<service>/di.py`
- HTTP services **MUST** use `quart-dishka` integration with `@inject` decorator
- **FORBIDDEN**: Direct imports of concrete classes in business logic

## 4. Documentation

### 4.1. Google-Style Docstrings
- **MUST** have docstrings for all public modules, classes, functions, methods
- **Content**: Purpose, Args, Returns, Raises
- **MUST** be Google-style format

### 4.2. Inline Comments
- Use for non-obvious logic or "why" (not "what")

## 5. Naming Conventions
- Modules/Packages: `snake_case.py`
- Classes/Exceptions: `PascalCase` (Exceptions end with `Error`)
- Functions/Methods/Variables: `snake_case`
- Constants: `UPPER_SNAKE_CASE`
- Private: `_private_member`

## 6. Code Structure
- **Imports**: Use absolute imports for modules outside the current service. **MUST** use absolute imports for intra-service modules.
- **Error Handling**: Catch specific exceptions, use domain-specific exceptions
- **Line Length**: Max 100 characters (hard limit enforced by CI where possible).
- **File Size**: Max 400 lines of code (LoC) per Python file (hard limit enforced by CI where possible, e.g., via `scripts/loc_guard.sh`).
- **Blank Lines**: Per PEP 8

## 7. Import Standards for Containerized Services

- **MUST** use absolute imports for all intra-service modules
- **FORBIDDEN**: Relative imports (`from .api`, `from .config`) in containerized services
- **Reason**: Container script context breaks relative import resolution

```python
# ✅ CORRECT
from api.health_routes import health_bp
from config import settings

# ❌ FORBIDDEN  
from .api.health_routes import health_bp
from .config import settings
```
===