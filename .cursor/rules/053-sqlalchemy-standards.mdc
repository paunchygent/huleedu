---
description: Read and follow SQLAlchemy implementations standards found here if your code contains SQL
globs: 
alwaysApply: false
---
# 052: SQLAlchemy Standards

## 1. Database Enums
- **MUST** use `str, enum.Enum` inheritance for database enums
- **FORBIDDEN**: Plain `enum.Enum` inheritance (causes SQLAlchemy KeyError)

```python
# ✅ CORRECT
class StatusEnum(str, enum.Enum):
    PENDING = "pending"
    COMPLETED = "completed"

# ❌ FORBIDDEN
class StatusEnum(enum.Enum):
    PENDING = "pending"
```

## 2. PostgreSQL Timestamps
- **MUST** use naive UTC timestamps for `TIMESTAMP WITHOUT TIME ZONE`
- **PATTERN**: Use `.replace(tzinfo=None)` to convert timezone-aware datetimes

```python
# ✅ CORRECT
updated_at=datetime.now(timezone.utc).replace(tzinfo=None)

# ❌ FORBIDDEN 
updated_at=datetime.now(timezone.utc)  # Causes timezone errors
```

## 3. Enum Field Configuration
- **REQUIRED**: Use `values_callable=lambda obj: [e.value for e in obj]` for PostgreSQL enums

```python
status: Mapped[StatusEnum] = mapped_column(
    SQLAlchemyEnum(
        StatusEnum,
        name="status_enum",
        values_callable=lambda obj: [e.value for e in obj]
    ),
    nullable=False,
)
```

===

