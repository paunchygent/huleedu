---
description: MUST READ whenever working on or discussing pdm resolution, versioning, and .toml files
globs: 
alwaysApply: false
---
# 081: PDM Dependency Management Standards

## 1. Purpose
This rule defines PDM dependency management standards for the HuleEdu monorepo, validated against actual PDM capabilities.

## 2. PDM Configuration Standards

### 2.1. Rule: Minimal Configuration
Your `pyproject.toml` **MUST** use minimal PDM configuration. PDM defaults are well-designed and optimal:

```toml
[tool.pdm]
distribution = false  # Application/library, not distributable package
```

### 2.2. Rule: No Custom Resolution Settings
**FORBIDDEN**: Do not add custom resolution settings. These are handled by PDM defaults:
- `strategy.inherit_metadata = True` (DEFAULT)
- `strategy.resolve_max_rounds = 10000` (DEFAULT)
- `strategy.save = minimum` (DEFAULT)
- `strategy.update = reuse` (DEFAULT)

## 3. Dependency Version Strategy

### 3.1. Rule: Let PDM Handle Versions
**REQUIRED**: Use unconstrained dependency specifications:

```toml
[dependency-groups]
monorepo-tools = [
    "ruff",           # âœ… No version constraints
    "mypy",
    "pytest",
    "pytest-cov",
    "pytest-asyncio",
    "pre-commit"
]
```

**Why**: PDM resolves latest compatible versions and locks them in `pdm.lock`.

### 3.2. Rule: Version Constraints Only When Necessary
Only add version constraints for:
- Breaking changes in major versions
- Known incompatibilities
- Security requirements

## 4. Validation Commands

### 4.1. Rule: Regular Validation
**MUST** run these commands to validate configuration:

```bash
# Check lock file is current
pdm lock --check

# Update to latest compatible versions
pdm update

# Verify installation works
pdm install
```

## 5. Scripts Configuration

### 5.1. Rule: Standard Scripts
**REQUIRED** scripts for monorepo management:

```toml
[tool.pdm.scripts]
format-all = "ruff format --force-exclude ."
lint-all = "ruff check --force-exclude ."
lint-fix = "ruff check --fix --force-exclude ."
typecheck-all = "mypy --config-file pyproject.toml ."
test-all = "pytest -n auto"
```

---
**PDM's defaults are optimal. Minimal configuration prevents issues.**
