---
description: Always use if linting issues are reported
globs: 
alwaysApply: false
---
# 110.5: Refactoring/Linting Mode

## 1. Guidelines

### 1.1. Adhere to Python Coding Standards
- When refactoring code or addressing linting issues, **MUST** strictly follow all rules in [050-python-coding-standards.mdc](mdc:050-python-coding-standards.mdc)
- Includes applying Ruff formatting and linting, and addressing MyPy type checking issues

### 1.2. Use PDM Scripts for Tooling
- **MUST** use `pdm run format-all`, `pdm run lint-all`, and `pdm run typecheck-all` when proposing commands to automatically fix formatting, linting, or identify typing issues
- **Critical**: Always use `--force-exclude` flag in Ruff commands to ensure proper exclusion of ignored directories

### 1.3. Prioritize Clarity and Maintainability
- Refactoring **SHOULD** aim to improve code readability, reduce complexity, remove duplication, and enhance maintainability without changing the code's external behavior

### 1.4. Address Linting and Typing Issues Systematically
- **MUST** address reported Ruff and MyPy errors/warnings methodically
- Use `ruff check --fix --force-exclude .` for auto-fixable issues first, then manually address remaining issues
- For MyPy errors, **MUST** ensure correct and precise type hints are added or corrected
- **MUST** configure per-file ignores in `pyproject.toml` for intentional violations (e.g., imports after `load_dotenv()`)

### 2.5. Rule: Use the `edit_file` Tool for Changes
    - **MUST** use the `edit_file` tool to propose refactoring changes or apply linting/typing fixes.
    - Ensure the `code_edit` accurately reflects the necessary changes and uses the `// ... existing code ...` marker correctly.

### 2.6. Rule: Verify Changes with Tests
    - After refactoring or applying fixes, **MUST** propose running relevant tests (unit, integration) to ensure that no regressions were introduced.
    - As required by [070-testing-and-quality-assurance.mdc](mdc:070-testing-and-quality-assurance.mdc), **MUST NOT** consider the task complete until tests pass.

### 2.7. Rule: Avoid Unnecessary or Disruptive Changes
    - **SHOULD** avoid large-scale, disruptive refactoring unless explicitly requested or clearly necessary to address significant technical debt or architectural violations.

### 2.8. Rule: Document Significant Refactoring
    - If refactoring significantly changes the internal structure of a module or class, **SHOULD** update relevant docstrings and inline comments.

---
**Maintaining code quality through refactoring and addressing linting issues is an ongoing responsibility.**
===
