# .pre-commit-config.yaml
# See https://pre-commit.com for more information

repos:
-   repo: local
    hooks:
    -   id: sync-agents-md
        name: Sync AGENTS.md to AI assistant files
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && pdm run python scripts/utils/sync_agents_md.py'
        language: system
        files: ^AGENTS\.md$
        pass_filenames: false
        stages: [pre-commit]

    -   id: sync-rules
        name: Sync Rules from .md to .md
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && pdm run python scripts/utils/sync_rules.py --source .claude/rules --target .windsurf/rules'
        language: system
        always_run: true
        pass_filenames: false
        stages: [pre-commit]

    -   id: validate-tasks-frontmatter
        name: Validate TASKS frontmatter and structure
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && pdm run python -m scripts.task_mgmt.validate_front_matter'
        language: system
        files: ^TASKS/.*\.md$
        exclude: ^TASKS/(_REORGANIZATION_PROPOSAL|INDEX|README|archive/)
        pass_filenames: false
        stages: [pre-commit]

    -   id: validate-docs-structure
        name: Validate documentation structure
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && pdm run python -m scripts.docs_mgmt.validate_docs_structure'
        language: system
        files: ^docs/.*\.md$
        exclude: ^docs/(DOCS_STRUCTURE_SPEC|_archive/)
        pass_filenames: false
        stages: [pre-commit]

    -   id: validate-claude-structure
        name: Validate .claude/ structure and rule frontmatter
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && pdm run python -m scripts.claude_mgmt.validate_claude_structure'
        language: system
        files: ^\.claude/rules/.*\.md$
        exclude: ^\.claude/rules/README\.md$
        pass_filenames: false
        stages: [pre-commit]

    -   id: markdownlint
        name: Lint markdown files
        entry: markdownlint --fix --config .markdownlint.json
        language: node
        files: \.(md|markdown)$
        additional_dependencies: ['markdownlint-cli@0.45.0']
        stages: [pre-commit]

    -   id: format-python
        name: Format Python files with ruff
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && git ls-files "*.py" | xargs -r pdm run ruff format'
        language: system
        files: \.py$
        pass_filenames: false
        stages: [pre-commit]

    -   id: lint-python
        name: Lint Python files with ruff
        entry: bash -c 'cd "$(git rev-parse --show-toplevel)" && git ls-files "*.py" | xargs -r pdm run ruff check --fix --unsafe-fixes'
        language: system
        files: \.py$
        pass_filenames: false
        stages: [pre-commit]
