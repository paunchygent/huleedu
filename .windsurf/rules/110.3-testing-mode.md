---
trigger: model_decision
description: "Testing mode for AI agents. Follow when using AI assistance for creating, running, or maintaining tests."
---

===
# 110.3: Testing Mode

## 1. Purpose
This rule defines your (AI agent's) guidelines when operating in Testing Mode.

## 2. Guidelines

### 2.1. Rule: Adhere to Testing Standards
    - **MUST** strictly follow all rules and guidelines in [070-testing-and-quality-assurance.mdc](mdc:070-testing-and-quality-assurance.mdc) when creating or modifying tests.
    - This includes using Pytest, following naming conventions, using fixtures correctly, and ensuring test isolation.

### 2.2. Rule: Prioritize Unit and Contract Tests
    - **MUST** prioritize generating unit tests and contract tests as they provide the most value for the effort in a microservice architecture.
    - **MUST** ensure that contract tests are created or updated whenever shared Pydantic models change.

### 2.3. Rule: Write Meaningful Tests
    - **MUST** write tests that verify correct behavior based on requirements and design, not just achieve code coverage.
    - Tests **SHOULD** be readable, maintainable, and focused.

### 2.4. Rule: Use PDM Run for Execution
    - When proposing test execution to the user, **MUST** always use `pdm run pytest ...` or `pdm run <specific_test_script>` as specified in [080-repository-workflow-and-tooling.mdc](mdc:080-repository-workflow-and-tooling.mdc).

### 2.5. Rule: Debug Tests with -s Flag
    - When assisting the user with debugging failing tests, **SHOULD** suggest running tests with the `-s` flag (`pdm run pytest -s ...`) to display print statements.

### 2.6. Rule: Analyze Test Failures
    - If tests fail after your code changes or during a debugging task, **MUST** analyze the test output to understand the cause.
    - **MUST** correlate test failures with recent code changes or identified issues.

### 2.7. Rule: Propose Fixes for Code, Not Tests
    - **CRITICAL**: If tests fail, the issue is almost always in the application code or environment configuration, NOT the test itself (unless the test is newly written and incorrect).
    - **STRICTLY FORBIDDEN**: Do not propose simplifying or weakening tests to make them pass. **MUST** focus on identifying and fixing the underlying issue in the application code as required by [070-testing-and-quality-assurance.mdc](mdc:070-testing-and-quality-assurance.mdc).

### 2.8. Rule: Update Tests for Changes
    - If code changes intentionally alter behavior, **MUST** update existing tests or write new ones to reflect the correct new behavior.

### 2.9. Rule: Document New Test Strategies
    - If a task requires a new testing strategy or significant changes to existing testing patterns, **SHOULD** propose updates or additions to [070-testing-and-quality-assurance.mdc](mdc:070-testing-and-quality-assurance.mdc).

---
**Rigorous and correctly implemented tests are your primary defense against regressions and architectural drift.**
===
