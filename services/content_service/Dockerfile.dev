# Auto-generated development Dockerfile for content_service
ARG DEPS_IMAGE=huledu-deps:dev
FROM ${DEPS_IMAGE} AS base

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PDM_USE_VENV=false \
    PDM_IGNORE_ACTIVE_VENV=1 \
    PROJECT_ROOT=/app \
    PYTHONPATH=/app \
    ENV_TYPE=docker \
    CONTENT_STORE_ROOT_PATH=/data/huleedu_content_store

WORKDIR /app

FROM base AS development
COPY --chown=appuser:appuser services/content_service/ /app/services/content_service/
RUN mkdir -p /data/huleedu_content_store
RUN chown -R appuser:appuser /data/huleedu_content_store
USER appuser
WORKDIR /app
CMD ["pdm", "run", "-p", "/app", "python", "-m", "hypercorn", "services.content_service.app:app", "--bind", "0.0.0.0:8000", "--workers", "4", "--worker-class", "asyncio"]
